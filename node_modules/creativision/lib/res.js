var fs = require('fs');
var path = require('path');

//res解析处理器
o2c.runtime.res = function(res){
  //status
  res.status = function(n){this.statusCode = n;}
  //send
  res.send = function(str){
  	if(!o2c.isString(str)){o2c.error('res.send(string)的参数不为字符串。出错路由->'+res._req.url+'。');}
  	else{res.end(str);};
  };
  //json
  res.json = function(arr){
  	if(!o2c.isArray(arr)){o2c.error('res.json(arr)的参数不为数组。出错路由->'+res._req.url+'。');}
  	else{JSON.stringify(arr);};
  };
  //sendfile
  res.sendfile = function(filepath){
  	filepath = path.join(o2c.confdir.k,'..'+filepath);
  	var resrox = this;
  	fs.readFile(filepath, "binary",function(err,file){
  	  if (err) {
  	  	resrox.writeHead(500, {'Content-Type': 'text/plain'});
  	  	resrox.end();
  	  }else{
  	  	resrox.writeHead(200, {'Content-Type': 'image/jpg'});
  	  	resrox.write(file, "binary");
  	  	resrox.end();
  	  };
  	});
  };
  //render
  res.render = o2c.runtime.engine;
  //TAGS
  res.setHeader("X-Powered-By","Creativision");
  res.setHeader("Frame-Author","Miguel Valentine");
  return res;
}

//view配置
o2c.viewdir = function(dirpath){
  dirpath = path.join(o2c.confdir.k,dirpath);
  o2c.runtime.viewpath = dirpath;
};